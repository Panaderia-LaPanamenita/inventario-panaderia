<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario Panadería La Panameñita - Las Villas</title>
    <!-- Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Usamos 'Inter' para una tipografía limpia y profesional -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 50;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.3s ease-in-out;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }
    </style>
    <!-- Incluir la librería de EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        // Inicializar EmailJS con tu clave pública
        (function() {
            emailjs.init("G22FNd9C9t7JSEkS_");
        })();
    </script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Contenedor principal del formulario -->
    <div class="bg-white p-6 md:p-10 rounded-2xl shadow-xl w-full max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Inventario Panadería La Panameñita</h1>
        <p class="text-gray-500 text-center mb-6">Completa este formulario al inicio y al final de tu turno.</p>

        <!-- Formulario principal -->
        <form id="inventory-form" class="space-y-6">

            <!-- Sección de información básica -->
            <div class="bg-gray-50 p-6 rounded-xl shadow-inner space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="employee-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Empleado</label>
                        <select id="employee-name" name="employee-name" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="">Selecciona un nombre...</option>
                            <option value="Angela Pinto">Angela Pinto</option>
                            <option value="Joanny Maltez">Joanny Maltez</option>
                            <option value="Elizabeth Rivera">Elizabeth Rivera</option>
                        </select>
                    </div>
                    <div>
                        <label for="shift-type" class="block text-sm font-medium text-gray-700 mb-1">Turno</label>
                        <select id="shift-type" name="shift-type" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="">Selecciona un turno...</option>
                            <option value="Turno de la mañana">Turno de la mañana</option>
                            <option value="Turno de la noche">Turno de la noche</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sección de conteo de productos -->
            <div class="mt-8 space-y-4">
                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">Conteo de Productos</h2>
                <p class="text-sm text-gray-500">Por favor, ingresa la cantidad de cada producto en las columnas correspondientes.</p>

                <!-- Encabezados de la tabla -->
                <div class="hidden md:grid md:grid-cols-4 gap-2 text-sm font-semibold text-gray-600 bg-gray-100 p-2 rounded-lg">
                    <div class="col-span-1">Producto</div>
                    <div class="col-span-1 text-center">Cantidad Inicial</div>
                    <div class="col-span-1 text-center">Cantidad Producida</div>
                    <div class="col-span-1 text-center">Cantidad Final</div>
                </div>

                <!-- Lista de productos -->
                <div id="products-list" class="space-y-4 md:space-y-2">
                    <!-- Los productos se insertarán aquí dinámicamente -->
                </div>
            </div>

            <!-- Botón de envío -->
            <div class="pt-6">
                <button type="submit" id="submit-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                    Enviar Inventario
                </button>
            </div>

            <!-- Mensaje de carga y estado -->
            <div id="status-message" class="hidden text-center text-blue-600 font-semibold mt-4">
                Enviando correo... por favor espera un momento.
            </div>
        </form>
    </div>

    <!-- Modal para mostrar el resultado del envío -->
    <div id="email-modal-overlay" class="modal-overlay">
        <div id="email-modal" class="modal-content">
            <div class="flex justify-between items-center pb-4 border-b">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800"></h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="mt-4">
                <p id="modal-message" class="text-sm text-gray-700"></p>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('inventory-form');
        const productsList = document.getElementById('products-list');
        const submitButton = document.getElementById('submit-button');
        const statusMessage = document.getElementById('status-message');
        const modalOverlay = document.getElementById('email-modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // Lista de productos a inventariar
        const products = [
            "Bizcocho de Vainilla", "Bizcocho Napolitano", "Oreja", "Danesa", "Cañon",
            "Dona azucarada", "Pionono", "Mamallena", "Dona Glaseada", "Dona Rellena",
            "Mantecado", "Cono Relleno", "Volteado de Piña", "Pan Dulce", "Pie de Piña",
            "Enrollado de Mantequilla", "Rosquitas", "Pancito de Huevo", "Bolita de Pasas",
            "Pan Bolita", "Michitas", "Flauta", "Empanada de Carne", "Empanada de Queso",
            "Empanada de Pollo", "Pastelito de Carne", "Pastelito de Pollo", "Croissant", "Pan Crema"
        ];

        // Rellenar el formulario con los productos dinámicamente
        function populateProducts() {
            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'grid grid-cols-2 md:grid-cols-4 gap-2 border-b last:border-b-0 py-2 items-center';
                productDiv.innerHTML = `
                    <div class="font-medium text-gray-700 col-span-2 md:col-span-1">${product}</div>
                    <div class="flex flex-col md:flex-row gap-2 col-span-2 md:col-span-3">
                        <label class="md:hidden text-xs font-semibold text-gray-500">Inicial</label>
                        <input type="number" id="${product.replace(/\s/g, '-')}-inicial" name="${product}-inicial" min="0" value="0" class="w-full mt-1 block py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm text-sm">

                        <label class="md:hidden text-xs font-semibold text-gray-500">Producida</label>
                        <input type="number" id="${product.replace(/\s/g, '-')}-producida" name="${product}-producida" min="0" value="0" class="w-full mt-1 block py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm text-sm">

                        <label class="md:hidden text-xs font-semibold text-gray-500">Final</label>
                        <input type="number" id="${product.replace(/\s/g, '-')}-final" name="${product}-final" min="0" value="0" class="w-full mt-1 block py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm text-sm">
                    </div>
                `;
                productsList.appendChild(productDiv);
            });
        }

        populateProducts();

        // Función para mostrar el modal
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalOverlay.classList.add('active');
            modalOverlay.style.display = 'flex';
        }

        // Función para ocultar el modal
        function hideModal() {
            modalOverlay.classList.remove('active');
            setTimeout(() => {
                modalOverlay.style.display = 'none';
            }, 300);
        }

        // Manejar el envío del formulario
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            statusMessage.classList.remove('hidden');

            const employeeName = document.getElementById('employee-name').value;
            const shiftType = document.getElementById('shift-type').value;
            const currentDate = new Date().toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Generar la tabla HTML para el correo
            let inventoryHtmlTable = `
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Producto</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Inicial</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Producida</th>
                            <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Final</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            products.forEach(product => {
                const productSlug = product.replace(/\s/g, '-');
                const inicial = document.getElementById(`${productSlug}-inicial`).value;
                const producida = document.getElementById(`${productSlug}-producida`).value;
                const final = document.getElementById(`${productSlug}-final`).value;

                // Solo agrega las filas si hay valores en los campos
                if (inicial > 0 || producida > 0 || final > 0) {
                    inventoryHtmlTable += `
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;">${product}</td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${inicial}</td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${producida}</td>
                            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${final}</td>
                        </tr>
                    `;
                }
            });

            inventoryHtmlTable += `
                    </tbody>
                </table>
            `;

            // Preparar el objeto de datos para EmailJS
            const templateParams = {
                employee_name: employeeName,
                shift_type: shiftType,
                report_date: currentDate,
                inventory_data: inventoryHtmlTable
            };

            // Envío del correo
            emailjs.send('service_faqgll8', 'template_yb6g64n', templateParams)
                .then(function(response) {
                    console.log('Correo enviado con éxito', response.status, response.text);
                    showModal('¡Éxito!', 'El inventario ha sido enviado por correo con éxito.');
                    form.reset(); // Limpiar el formulario
                }, function(error) {
                    console.error('Error al enviar el correo:', error);
                    showModal('¡Error!', 'Hubo un problema al enviar el inventario. Por favor, inténtalo de nuevo.');
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    statusMessage.classList.add('hidden');
                });
        });

        // Cerrar el modal
        closeModalBtn.addEventListener('click', hideModal);

        // Cerrar el modal al hacer clic fuera de él
        modalOverlay.addEventListener('click', (e) => {
            if (e.target.id === 'email-modal-overlay') {
                hideModal();
            }
        });
    </script>
</body>
</html>
